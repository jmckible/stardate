<script type='text/javascript'>
  $(document).ready(function(){
    healthMonth = new Highcharts.Chart({
      chart: {
        renderTo: 'HealthMonth',
        width: 400,
        height: 300
      },
      title:  { text: false },
      legend: { enabled: false },
      yAxis: [{ // Excercise
       title: false
      }, { // Weight
       title: false,
       opposite: true
    }],
      xAxis: {
        type: 'datetime',
        tickInterval: 24 * 3600 * 1000, 
        labels: {
          step: 7,
          formatter: function(){
            return(Highcharts.dateFormat('%b %e',this.value));
          }
        }
      },
      series: [{
        type: 'column',
        name: 'Exercise',
        data: <%= @month.collect{|date| current_user.bikes.on(date).sum(:minutes) + current_user.runs.on(date).sum(:minutes) + current_user.ellipticals.on(date).sum(:minutes)}.to_json %>,
        pointInterval: 24 * 3600 * 1000,
        pointStart: Date.UTC(<%= @month.first.year %>, <%= @month.first.month %>, <%= @month.first.day %>),
        yAxis: 0
      }, {
        type: 'spline',
        name: 'Weight',
        data: <%= @month.collect{|date| current_user.weights.on(date).first.try(:weight)}.to_json %>,
        pointInterval: 24 * 3600 * 1000,
        pointStart: Date.UTC(<%= @month.first.year %>, <%= @month.first.month %>, <%= @month.first.day %>),
        yAxis: 1
      }]
    });
  });
</script>