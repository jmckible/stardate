<script type='text/javascript'>
  $(document).ready(function(){
    healthMonth = new Highcharts.Chart({
      chart: {
        renderTo: 'HealthMonth',
        width: 400,
        height: 280
      },
      title:  { text: false },
      legend: { enabled: false },
      yAxis:[
        {
          title: false
        }, 
        {
          title: false,
          opposite: true
        }
      ],
      xAxis: {
        type: 'datetime',
        tickInterval: 24 * 3600000,
        labels: {
          step: 7,
          formatter: function(){
            return(Highcharts.dateFormat('%b %e',this.value));
          }
        }
      },
      series: [{
        type: 'column',
        name: 'Exercise',
        data: <%= @month.collect{|date| current_user.bikes.on(date).sum(:minutes) + current_user.runs.on(date).sum(:minutes) + current_user.ellipticals.on(date).sum(:minutes)}.to_json %>,
        pointInterval: 24 * 3600000,
        pointStart: Date.UTC(<%= (@month.first - 1.month).year %>, <%= (@month.first - 1.month).month %>, <%= (@month.first - 1.month).day %>),
        yAxis: 0,
        pointWidth: 10,
        pointPadding: 0,
        shadow: false,
        color: '#00CCFF'
      }, {
        type: 'spline',
        name: 'Weight',
        data: <%= @month.collect{|date| {:y=>current_user.weights.on(date).first.try(:weight), :radius=>(((current_user.weights.on(date).first.try(:body_fat) || 10) - 10) / 24.0 * 20).round}}.to_json %>,
        pointInterval: 24 * 3600000,
        pointStart: Date.UTC(<%= (@month.first - 1.month).year %>, <%= (@month.first - 1.month).month %>, <%= (@month.first - 1.month).day %>),
        yAxis: 1,
        color: '#FF00CC'
      }]
    });
  });
</script>