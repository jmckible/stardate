%h1= humanize_period @period

= form_tag reports_path, method: :get do
  = select_month @start, prefix: 'start'
  = select_day   @start, prefix: 'start'
  = select_year  @start, prefix: 'start', start_year: @user.created_at.year, end_year: Date.today.year
  &mdash;
  = select_month @finish, prefix: 'finish'
  = select_day   @finish, prefix: 'finish'
  = select_year  @finish, prefix: 'finish', start_year: @user.created_at.year, end_year: Date.today.year
  = submit_tag 'Go'

#SpendingYear= render partial: 'graphs/spending_year'

%table
  %tr
    %td Income
    %td= color_money @income
  %tr
    %td Expenses
    %td= color_money @expenses
  %tr
    %td Net
    %td= color_money @net
  - unless @income.zero?
    %tr
      %td Savings Rate
      %td #{(@net / @income.to_f * 100).round(1)}%
  %tr
    %td Non-exceptional Income
    %td= color_money(@income - @exceptional)
  %tr
    %td Non-exceptional Net
    %td= color_money((@income - @exceptional + @expenses))
  - unless (@income - @exceptional).zero?
    %tr
      %td Non-exceptional Savings Rate
      %td #{((@income - @exceptional + @expenses) / (@income - @exceptional).to_f * 100).round(1)}%

%h2 Top Expenses
%table
  %tr
    %th Account
    %th Transactions
    %th Total
  - @expense_accounts.each do |account|
    %tr
      %td= account.name
      %td.count= account.transaction_count
      %td.count= color_money(account.total * -1)


%table
  %tr
    %th Account
    %th Transactions
    %th Total
  - @expense_tags.each do |tag|
    %tr
      %td= tag.name
      %td.count= tag.transaction_count
      %td.count= color_money(tag.total * -1)
